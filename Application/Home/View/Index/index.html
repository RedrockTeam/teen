<!DOCTYPE html>
<html 
	lang="zh-CN"
	data-add="{:U('Question/commit_voice')}"
	data-del="{:U('Question/delete_vioce')}"
	data-index="{:U('Index/index')}"
	data-login="{:U('User/login')}"
	data-detail="{:U('Question/detail')}"
	data-praise="{:U('Question/vote')}"
	data-comment="{:U('Question/commit_comment')}"
	data-personal="{:U('User/get_voice')}"
	
>
	<head>
		<meta charset="UTF-8">
		<title>青年之声</title>
		<link rel="stylesheet" href="__PUBLIC__/home/css/index.css">
		<link rel="stylesheet" href="http://apps.bdimg.com/libs/animate.css/3.1.0/animate.min.css">
	</head>
	<body>
		<div id="header">
			<div class="nav-bar">
				<ul>
					<li class="school-logo">
						<img src="__PUBLIC__/home/images/cqupt.png">
					</li>
					<li>
						<a href="javascript:void(0)">首页</a>
					</li>
					<li>
						<a href="javascript:void(0)">学生辅导</a>
					</li>
					<li>
						<a href="javascript:void(0)">职业规划</a>
					</li>
					<li>
						<a href="javascript:void(0)">心里互助</a>
					</li>
					<li>
						<a href="javascript:void(0)">书籍信箱</a>
					</li>
					<li>
						<a href="javascript:void(0)">接待中心</a>
					</li>
					<li>
						<a href="javascript:void(0)">售后服务</a>
					</li>
				</ul>
			</div>
			<div class="login-reg-btn">
				<span>登录</span>
			</div>
		</div>
		
		<div id="main">
			
			<div class="teen-logo">
				<img src="__PUBLIC__/home/images/logo.png">
			</div>
				
			<div class="main-content">

				<div class="left-sidebar">
					<div class="add-question-container">
						<p>提问框</p>
						<div class="at-question">
							<button>@提问</button>
						</div>
						<div class="public-question">
							<button>公开提问</button>
						</div>
					</div>
					
					<div class="website-link">
						<p>网站链接</p>
						<ul>
							<li>
								<a href="javascript:void(0)">红岩网校</a>
							</li>
							<li>
								<a href="javascript:void(0)">校学生会团宣部</a>
							</li>
							<li>
								<a href="javascript:void(0)">体育部</a>
							</li>
							<li>
								<a href="javascript:void(0)">勤工助学部</a>
							</li>
							<li>
								<a href="javascript:void(0)">宿管部</a>
							</li>
							<li>
								<a href="javascript:void(0)">科联</a>
							</li>
						</ul>
					</div>

				</div>
				
				<div class="middle">
					<div class="list-title">
						<div class="all-question on-focus">
							所有提问
						</div>
						<div class="ask-me">
							向我提问
						</div>
					</div>
					
					<div class="question-list">
						<volist name="voice" id="v">
							<div class="question">
								<div class="question-header">
									<div class="user-avatar">
										<img src="{$v.face}" >
									</div>
									<div class="user-name">{$v.postername}</div>
									<div class="post-date">
										<span>{$v.time|date="Y年m月d日", ###}</span>
										<span>{$v.time|date="H:i", ###}</span>
									</div>
								</div>
								<div class="question-body">
									<div class="question-title">
										<strong>{$v.title}</strong>
									</div>
									<div class="question-content">{$v.question}</div>
								</div>
								<div class="question-footer">
									<div class="question-praise">
										<i class="iconfont">&#xe600;</i>
										<span>2000</span>
									</div>
									<div class="question-comments-list">
										<volist name="v.comments" id="k">
											<div class="question-comment">
												<div class="comment-header">
													<img src="{$k.face}" width="28" height="28">
												</div>
												<div class="comment-body">
													<span class="comment-content">
														<strong class="comment-user-name">{$k.username}</strong>:&nbsp;
														{$k.comment}
													</span>
													<div class="comment-date">{$k.time|date="H:i", ###}</div>
												</div>
											</div>
										</volist>
									</div>
									<div class="question-reply">
										<form>
											<input type="hidden" name="id" value="{$v.id}">
											<input type="text" name="comment" placeholder="请输入回复内容">
											<button type="button" class="add-comment">回复</button>
										</form>
									</div>
								</div>
							</div>
						</volist>
					</div>
				</div>
				
				<div class="right-sidebar">
					<div class="weico-link-list">
						<p>微博链接</p>
						<ul class="weico-avatar-list">
							<?php 
								for ($i = 0; $i < 9; $i++) { 
									if ($i % 3 == 1) {
							?>
								<li class="weico-avatar-middle">
							<?php 	} else { ?>
								<li>
							<?php 	}	?>
									<img src="__PUBLIC__/home/images/face.png">
									<span>大哥大</span>
								</li>
							<?php } ?>
						</ul>
						<div class="show-more-weico">查看更多</div>
					</div>
					<div class="president-list">
						<p>主席信息</p>
						<ul>
							<volist name="chairman" id="v">
								<li>
									<img src="{$v.picture}" height="43" width="43">
									<div class="president-info">
										<p class="president-name">{$v.chairname}</p>
										<p class="president-dep">WEB研发部</p>
									</div>
									<div class="handle">
										<p class="view-info">查看信息</p>
										<p class="at-me">向他提问</p>
									</div>
								</li>
							</volist>
						</ul>
						<div class="show-more-president">查看更多</div>
					</div>
				</div>

			</div>	
			
		</div>

		<div id="footer">
			<p>关于红岩网校 | 开发团队 | 指出错误 | 管理入口</p>
			<p>地址:重庆市南岸区南山街道崇文路2号重庆邮电大学 联系电话:62461084/62487910</p>
			<p>本网站由红岩网校工作站负责开发管理,不经红岩网校委员会书面同意,不得进行转载</p>	
		</div>

		<!-- 遮罩层 -->
		<div class="dimmer" style="">
		</div>

		<!-- @提问 -->
		<div id="add-question-view-at">
			<div class="add-question-view-at-header">
				<strong>@提问</strong>
				<i class="iconfont">&#xe603;</i>
			</div>
			<div class="add-question-view-at-body">
				<form class="add-question-form">
					<div class="form-control">
							<select name="" id="">
							<volist name="chairman" id="v">
								<option value="{$v.id}">{$v.chairname}</option>
							</volist>
						</select>
					</div>
					<div class="form-control">
						<input type="text" placeholder="请输入标题">
					</div>
					<div class="form-control">
						<textarea name="question-content" placeholder="请输入内容"></textarea>
					</div>
					<div class="form-control">
						<button type="button">提问</button>
					</div>
				</form>
			</div>
		</div>

		<!-- 公开提问 -->
		<div id="add-question-view-public">
			<div class="add-question-view-public-header">
				<strong>公开提问</strong>
				<i class="iconfont">&#xe603;</i>
			</div>
			<div class="add-question-view-public-body">
				<form class="add-question-form">
					<div class="form-control">
						<input type="text" placeholder="请输入标题">
					</div>
					<div class="form-control">
						<textarea name="question-content" placeholder="请输入内容"></textarea>
					</div>
					<div class="form-control">
						<button type="button">提问</button>
					</div>
				</form>
			</div>
		</div>

	</body>
	<script src="__PUBLIC__/home/js/jquery.min.js"></script>
	<script src="http://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	<script src="__PUBLIC__/home/js/layer.js"></script>

	
	<script>

			$(function () {


				function isLogin () {
					if (!$.cookie('stunum')) {
						layer.alert('你还未登录, 不能评论哦', {icon: 6});
						return;
					}
				}

				// 两个提问框定位
				$('#add-question-view-public').add('#add-question-view-at').css({
					top: ($(window).height() +  $(document).scrollTop() - 467) / 2,
					left: ($(window).width() - 664) / 2
				});



				// 打开@提问框
				$('.at-question').click(function () {
					$('.dimmer').css({
						display: 'block',
						top: $(document).scrollTop()
					});
					$('#add-question-view-at').css('display', 'block').removeClass('bounceOutUp').addClass('animated bounceInDown');
					$('body').css('overflow', 'hidden');
				});

				// 关闭@提问框
				$('#add-question-view-at i').click(function () {
					$('.dimmer').css('display', 'none');
					$('#add-question-view-at').removeClass('bounceInDown').addClass('bounceOutUp');
					$('body').css('overflow', 'auto');
				});

				/*================================================================================*/

				// 打开公开提问框
				$('.public-question').click(function () {
					$('.dimmer').css({
						display: 'block',
						top: $(document).scrollTop()
					});
					$('#add-question-view-public').css('display', 'block').removeClass('bounceOutUp').addClass('animated bounceInDown');
					$('body').css('overflow', 'hidden');
				});

				// 关闭公开提问框
				$('#add-question-view-public i').click(function () {
					$('.dimmer').css('display', 'none');
					$('#add-question-view-public').removeClass('bounceInDown').addClass('bounceOutUp');
					$('body').css('overflow', 'auto');
				})


				// 登录文字定位
				var rightPosition = $('.nav-bar li:eq(7)').offset().left + 17 + $('.nav-bar li:eq(7)').width();
				$('.login-reg-btn').css({
					'opacity': 1,
					'left': rightPosition - $('.login-reg-btn').width()
				});


				$('.login button').click(function () {
					event.preventDefault();
					$.ajax({
						url: 'index.php?s=/Home/Index/login',
						type: 'POST',
						dataType: 'json',
						data: $('.login-form').serialize()
					}).done(function (response) {
						if (response.status == 200) {
							$('.login-reg-btn span').html(response.username);
							$.cookie('stunum', response.stunum);
							$.cookie('username', response.username);
							layer.close();
						} else {
							alert('fail');
						}
					}).fail(function() {
						alert('cuowu');
					});
				});


				// 添加评论
				$('.question-list').on('click', '.add-comment', function () {

					isLogin();

					var self = this;
					if (!$.trim($(this).parent().find('input[name=comment]').val())) {
						$(this).parent().find('input[name=comment]').css('border', '1px solid #dd514c');
						return;
					}
					$.ajax({
						url: $('html').data('comment'),
						type: 'POST',
						data: $(self).parent().serialize(),
						beforeSend: function () {
							$(self).css('background-color', '#c0c0c0');
						}
					}).done(function (response) {
						var html = '';
						if (response.status == 200) {
							html += '<div class="question-comment">';
								html += '<div class="comment-header">';
									html += '<img src="'+ response.data.touxiang +'" width="28" height="28">';
								html += '</div>';
								html += '<div class="comment-body">';
									html += '<span class="comment-content">';
										html += '<strong class="comment-user-name">'+ response.data.username +'</strong>:&nbsp;';
										html += response.data.comment;
									html += '</span>';
									html += '<div class="comment-date">'+ response.data.time +'</div>';
								html += '</div>';
							html += '</div>';
							$(self).parents('.question-reply').prev().append(html);
						} else {
							
						}
					}).fail(function() {
						alert('message');
					}).always(function () {
						$(this).parent().find('input[name=comment]').val('');
						$(self).css('background-color', '#3686c5');
					});
				});

				
				function addQuestion () {
					$.ajax({
						url: $('html').data('question'),
						type: 'POST',
						data: {param1: 'value1'},
					}).done(function() {
						console.log("success");
					}).fail(function() {
						console.log("error");
					}).always(function() {
						console.log("complete");
					});
					
				}
	

			})

	</script>

</html>