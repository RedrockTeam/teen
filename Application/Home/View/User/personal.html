<!DOCTYPE html>
<html 
	lang="zh-CN"
	data-add="{:U('Question/commit_voice')}"
	data-del="{:U('Question/delete_vioce')}"
	data-index="{:U('Index/index')}"
	data-login="{:U('User/login')}"
	data-detail="{:U('Question/detail')}"
	data-praise="{:U('Question/vote')}"
	data-comment="{:U('Question/commit_comment')}"
	data-personal="{:U('User/get_voice')}"
	data-loadmore="{:U('Index/load_home_data')}"
	data-chariLogin="{:U('User/chair_login')}"
>
	<head>
		<meta charset="UTF-8">
		<title>青年之声</title>
		<link rel="stylesheet" href="__PUBLIC__/home/css/index.css">
		<link rel="stylesheet" href="http://apps.bdimg.com/libs/animate.css/3.1.0/animate.min.css">
	</head>
	<body>
		<div id="header">
			<div class="nav-bar">
				<ul>
					<li class="school-logo">
						<img src="__PUBLIC__/home/images/cqupt.png">
					</li>
					<li class="nav">
						<a href="__MODULE__/Index">首页</a>
					</li>
					<li class="nav">
						<a href="http://xsc.cqupt.edu.cn/xyfd">学业辅导</a>
					</li>
					<li class="nav">
						<a href="http://cqupt.ncss.org.cn/jixun/Info/IeOnly.html">职业规划</a>
					</li>
					<li class="nav">
						<a href="http://202.202.43.69/XinLiweb">心理互助</a>
					</li>
					<li class="nav">
						<a href="http://president-mail.cqupt.edu.cn">校长信箱</a>
					</li>
					<li class="nav">
						<a href="http://job.cqupt.edu.cn">就业中心</a>
					</li>
					<li class="nav">
						<a href="http://jjc.cqupt.edu.cn">后勤中心</a>
					</li>
				</ul>
			</div>
			<div class="login-reg-btn">
				<if condition="$Think.session.username neq ''">
					<span><a href="__MODULE__/User/logout">退出</a></span>
				<else/>
					<span class="open-login-view">登录</span>
				</if>
			</div>
		</div>
		
		<div id="main">
			
			<div class="teen-logo">
				<img src="__PUBLIC__/home/images/logo.png">
			</div>
				
			<div class="main-content">

				
				<div class="middle" style="width: 758px; float: none; margin: 0 auto; min-height: 330px">
					<div class="list-title">
						<div class="all-question on-focus">
							我的提问
						</div>
						<if condition="$Think.session.userType neq ''">
							<div class="ask-me">向我提问</div>
						</if>
					</div>
					
					<div class="question-list">
						<volist name="data.question" id="v">
							<div class="question" data-index="{$v.id}">
								<div class="question-header">
									<div class="question-delete" data-id="{$v.id}"><i class="iconfont">&#xe603;</i></div>
									<div class="user-avatar">
										<img src="{$v.touxiang}" >
									</div>
									<div class="user-name">{$v.postername}</div>
									<div class="post-date">
										<span>{$v.time|date="Y年m月d日", ###}</span>
										<span>{$v.time|date="H:i", ###}</span>
									</div>
								</div>
								<div class="question-body">
									<div class="question-title">
										<strong>{$v.title}</strong>
										<if condition="$v.gettername eq 'public'">
											<span>公共提问</span>
										<else/>
											<span>@{$v.gettername}</span>
										</if>
									</div>
									<div class="question-content">{$v.question}</div>
								</div>
								<div class="question-footer">
									<div class="question-praise">
										<if condition="$v.is_voted eq 'true'">
											<i class="iconfont" data-id="{$v.id}">&#xe604;</i>
										<else/>
											<i class="iconfont" data-id="{$v.id}">&#xe605;</i>
										</if>
										<span>{$v.vote}</span>
									</div>
									<div class="question-comments-list">
										<volist name="v.comments" id="k">
											<div class="question-comment">
												<div class="comment-header">
													<img src="{$k.touxiang}" width="28" height="28">
												</div>
												<div class="comment-body">
													<span class="comment-content">
														<strong class="comment-user-name">{$k.username}</strong>:&nbsp;
														{$k.comment}
													</span>
													<div class="comment-date">{$k.time|date="H:i", ###}</div>
												</div>
											</div>
										</volist>
									</div>
									<div class="question-reply">
										<form>
											<input type="hidden" name="id" value="{$v.id}">
											<input type="text" name="comment" placeholder="请输入回复内容" style="width: 644px;">
											<button type="button" class="add-comment">回复</button>
										</form>
									</div>
								</div>
							</div>
						</volist>
					</div>

					<div class="be-question-list" style="display: none">
						<volist name="data.be_question" id="v">
							<div class="question" data-index="{$v.id}">
								<div class="question-header">
									<div class="user-avatar">
										<img src="{$v.touxiang}" >
									</div>
									<div class="user-name">{$v.postername}</div>
									<div class="post-date">
										<span>{$v.time|date="Y年m月d日", ###}</span>
										<span>{$v.time|date="H:i", ###}</span>
									</div>
								</div>
								<div class="question-body">
									<div class="question-title">
										<strong>{$v.title}</strong>
									</div>
									<div class="question-content">{$v.question}</div>
								</div>
								<div class="question-footer">
									<div class="question-praise">
										<if condition="$v.is_voted eq 'true'">
											<i class="iconfont" data-id="{$v.id}">&#xe604;</i>
										<else/>
											<i class="iconfont" data-id="{$v.id}">&#xe605;</i>
										</if>
										<span>{$v.vote}</span>
									</div>
									<div class="question-comments-list">
										<volist name="v.comments" id="k">
											<div class="question-comment">
												<div class="comment-header">
													<img src="{$k.touxiang}" width="28" height="28">
												</div>
												<div class="comment-body">
													<span class="comment-content">
														<strong class="comment-user-name">{$k.username}</strong>:&nbsp;
														{$k.comment}
													</span>
													<div class="comment-date">{$k.time|date="H:i", ###}</div>
												</div>
											</div>
										</volist>
									</div>
									<div class="question-reply">
										<form>
											<input type="hidden" name="id" value="{$v.id}">
											<input type="text" name="comment" placeholder="请输入回复内容" style="width: 644px;">
											<button type="button" class="add-comment">回复</button>
										</form>
									</div>
								</div>
							</div>
						</volist>
					</div>
				</div>
				
			</div>	
			
		</div>

		<div id="footer">
			<p>关于红岩网校 | 开发团队 | 指出错误 | 管理入口</p>
			<p>地址:重庆市南岸区南山街道崇文路2号重庆邮电大学 联系电话:62461084/62487910</p>
			<p>本网站由红岩网校工作站负责开发管理,不经红岩网校委员会书面同意,不得进行转载</p>	
		</div>

		<!-- 遮罩层 -->
		<div class="dimmer" style=""></div>

		<!-- 回到顶部 -->
		<div class="return-top">
			<i class="iconfont">&#xe601;</i>
		</div>

		<!-- @提问 -->
		<div id="add-question-view-at">
			<div class="add-question-view-at-header">
				<strong>@提问</strong>
				<i class="iconfont">&#xe603;</i>
			</div>
			<div class="add-question-view-at-body">
				<form class="add-private-question-form">
					<div class="form-control">
						<select name="type">
							<volist name="chairman" id="v">
								<option value="{$v.id}">{$v.chairname}</option>
							</volist>
						</select>
					</div>
					<div class="form-control">
						<input type="text" name="title" placeholder="请输入标题">
					</div>
					<div class="form-control">
						<textarea name="content" placeholder="请输入内容"></textarea>
					</div>
					<div class="form-control">
						<button type="button">提问</button>
					</div>
				</form>
			</div>
		</div>

		<!-- 公开提问 -->
		<div id="add-question-view-public">
			<div class="add-question-view-public-header">
				<strong>公开提问</strong>
				<i class="iconfont">&#xe603;</i>
			</div>
			<div class="add-question-view-public-body">
				<form class="add-public-question-form">
					<input type="hidden" name="type" value="public">
					<div class="form-control">
						<input type="text" name="title" placeholder="请输入标题">
					</div>
					<div class="form-control">
						<textarea name="content" placeholder="请输入内容"></textarea>
					</div>
					<div class="form-control">
						<button type="button">提问</button>
					</div>
				</form>
			</div>
		</div>
	

		<!-- 登录页面 -->
		<div id="login-view-container">
			
			<div class="login-view-header">
				<strong>公开提问</strong>
				<i class="iconfont">&#xe603;</i>
			</div>
			<div class="login-view-body">
				<form class="user-form">
					<div class="form-control">
						<label for="">
							<span>登录账号:</span>
							<strong style="color: #9a9a9a">主席用户</strong>
							<strong>/</strong>
							<strong style="color: #5082c7">普通用户</strong>
						</label>
						<input type="text" name="username" placeholder="请输入学号或者教师一卡通号">
					</div>
					<div class="form-control">
						<label for="">登录密码:</label>
						<input type="password" name="password" placeholder="请输入密码">
					</div>
					<div class="form-control">
						<button type="button">登录</button>
					</div>
				</form>

				<form class="chairman-form" style="display: none">
					<input type="hidden" name="type" value="chairman">
					<div class="form-control">
						<label for="">
							<span>登录账号:</span>
							<strong style="color: #5082c7">主席用户</strong>
							<strong>/</strong>
							<strong style="color: #9a9a9a">普通用户</strong>
						</label>
						<input type="text" name="chairname" placeholder="请输入主席姓名">
					</div>
					<div class="form-control">
						<label for="">登录密码:</label>
						<input type="password" name="password" placeholder="请输入密码">
					</div>
					<div class="form-control">
						<button type="button">登录</button>
					</div>
				</form>
			</div>

		</div>

	</body>
	<script src="__PUBLIC__/home/js/jquery.min.js"></script>
	<script src="http://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	<script src="__PUBLIC__/home/js/layer.js"></script>

	
	<script>

			/*
			 	这是一段不可维护代码
			 	手机端的代码可以看
			 	我实在不想写了
			 	姚老板说明天必须上线
			 	那就先这样了吧
			 	如果你要改这段代码
			 	祝你好运
			 */	

			$(function () {


				function isLogin () {
					if ($.cookie('stunum') == '' || $.cookie('stunum') == undefined) {
						return false;
					} else {
						return true;
					}
				}

				// 登录文字定位
				var rightPosition = $('.nav-bar li:eq(7)').offset().left + 17 + $('.nav-bar li:eq(7)').width();
				$('.login-reg-btn').css({
					'opacity': 1,
					'left': rightPosition - $('.login-reg-btn').width()
				});


				// 添加评论
				$('.question-list').add('.be-question-list').on('click', '.add-comment', function () {

					if (isLogin()) {
						var self = this;
						if (!$.trim($(this).parent().find('input[name=comment]').val())) {
							layer.msg('评论内容不能为空', {time: 1000});
							return;
						}
						$.ajax({
							url: $('html').data('comment'),
							type: 'POST',
							data: $(self).parent().serialize(),
							beforeSend: function () {
								$(self).css('background-color', '#c0c0c0');
							}
						}).done(function (response) {
							var html = '';
							if (response.status == 200) {
								html += '<div class="question-comment">';
									html += '<div class="comment-header">';
										html += '<img src="'+ response.data.touxiang +'" width="28" height="28">';
									html += '</div>';
									html += '<div class="comment-body">';
										html += '<span class="comment-content">';
											html += '<strong class="comment-user-name">'+ response.data.username +'</strong>:&nbsp;';
											html += response.data.comment;
										html += '</span>';
										html += '<div class="comment-date">'+ response.data.time +'</div>';
									html += '</div>';
								html += '</div>';
								$(self).parents('.question-reply').prev().append(html);
							} else {
								layer.alert('评论有误, 请重新评论', {icon: 6});
							}
						}).fail(function() {
							layer.alert('系统好像出了点问题, 请刷新试试!', {icon: 6});
						}).always(function () {
							$(self).parent().find('input[name=comment]').val('');
							$(self).css('background-color', '#3686c5');
						});
					} else {
						layer.alert('你还未登录, 不能进行此操作', {icon: 6});
					}
				});

				// 点赞
				$('.question-list').add('.be-question-list').on('click', '.question-praise i', function () {
					if (isLogin()) {
						var self = this;
						$.ajax({
							url: $('html').attr('data-praise'),
							type: 'POST',
							data: {id: $(self).attr('data-id')}
						}).done(function (response) {
							if (response.status === 200) {
								$(self).html('&#xe604;');
								console.log($(self).next().text());
								$(self).next().html(Number($(self).next().text()) + 1);
								layer.msg('点赞成功', {time: 500});
							} else {
								layer.msg('不能重复点赞', {time: 500});
							}
						}).fail(function() {
							console.log("error");
						}).always(function() {
							console.log("complete");
						});
					} else {
						layer.alert('你还未登录, 不能进行此操作', {icon: 6});
					}
				});
				
				// 删除
				$('.question-list').on('click', '.question-delete', function () {
					var self = this;
					layer.alert('此操作将删除问题和相关评论', function (index) {
						$.post($('html').attr('data-del'), {id: $(self).data('id')}, function(response, textStatus) {
							if (response.status == 200) {
								layer.msg('删除成功', {time: 1000}, function () {
									// 移除问题
									$(self).parents('.question').fadeOut();
									$(self).parents('.question').remove();
								});
							} else {
								layer.msg('删除失败,请刷新试试', {icon: 5, time: 1000});
							}
						}).error(function () {
							layer.msg('删除失败,请刷新试试', {icon: 5, time: 1000});
						});
					});
				});


				// @提问
				$('.ask-me').on('click', function () {
					if ($('.be-question-list .question').length > 0) {
						$('.question-list').removeClass('bounceInLeft').addClass('animated bounceOutLeft');
						setTimeout(function () {
							$('.question-list').css('display', 'none');
							$('.all-question').removeClass('on-focus');
							$('.be-question-list').removeClass('bounceOutRight').addClass('animated bounceInRight').css('display', 'block');
							$('.ask-me').addClass('on-focus');
						}, 500);
					}
				});

				$('.all-question').on('click', function () {
					$('.be-question-list').removeClass('bounceInRight').addClass('bounceOutRight');
					setTimeout(function () {
						$('.be-question-list').css('display', 'none');
						$('.ask-me').removeClass('on-focus');
						$('.question-list').removeClass('bounceOutLeft').addClass('animated bounceInLeft').css('display', 'block');
						$('.all-question').addClass('on-focus');
					}, 500);
				});



				$(window).scroll(function(event) {
					if ($(window).scrollTop() > $('.middle').offset().top) {
						$('.return-top').css({
							display: 'block',
							left: $('.middle').offset().left + $('.middle').width() + 20
						});
					} else {
						$('.return-top').css('display', 'none');
					}
				});

				$('.return-top').on('click', function () {
					$("html,body").animate({scrollTop:0}, 500);
				});
				

			})

	</script>

</html>